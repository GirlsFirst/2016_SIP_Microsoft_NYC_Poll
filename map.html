<!DOCTYPE html>
<html lang="en">
  <head>

  <title>
    Locate Your Polling Location
  </title>
  <meta charset = "utf-8">
  <meta name = "viewport" content = "width-device-width, initial-scale = 1.0, user-scalable = no">

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

  <!-- jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

  <!-- Latest compiled JavaScript -->
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

   <!-- css -->
  <link rel="stylesheet" type="text/css" href="mapcss.css">
  

  </head>
  <body>
  
  <div class = "container">

<!--  nav bar -->
  <nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div id= "logo">
      <center><img src= "newlogo.png" width=250 height=200></center>
    </div>
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
     <!--  <a class="navbar-brand" href="#">Poll Me</a> -->
    </div>


    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
 
      <ul class="nav nav-tabs nav-justified">
        <li><a href="index.html">Home</a></li>
        <li><a href="map.html">Map</a></li>
            <li><a href="howto.html">How-To</a></li>
            <li><a href="contactus.html">Contact Us </a></li>
          </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->

<br>
    <div id="floating-panel">
      <input id="address" type="textbox" value="New York">
      <input id="submit" type="button" value="Find voting locations near me!">
    </div>

  <div id="map">

    <script>
    

    var polldata;

    // this is where loop begins

    var markers=[];

    var map;

function polls(){
      for (var i=0; i<1201; i++){
        var latitude = polldata.data[i][19][1];
        var longitude = polldata.data[i][19][2];
        var marked = new google.maps.Marker({
          position: {lat: parseFloat(latitude), lng:parseFloat(longitude)},
          map:map
        });

        var infowindow = new google.maps.InfoWindow({
        content: contentString,

        });

        var contentString = 
        '<div id="content">'+
        '<div id="siteNotice">'+
        '</div>'+
        '<h3>' + polldata.data[i][10] +'</h3>'+
        '<div id="bodyContent">'+
        '<p> Voter Entrance: ' + polldata.data[i][17] + ' ' +polldata.data[i][15] + ' ' + polldata.data[i][16] + '</p>' +
        '<p> Handicap Entrance: ' + polldata.data[i][18] + ' ' +polldata.data[i][15] + ' ' + polldata.data[i][16] + '</p>'
      '</div>'+
      '</div>';



        google.maps.event.addListener (marked, 'click', getInfoCallback(map, contentString));

        markers.push(marked);
      }
    }

    function getInfoCallback(map,content){
    var infowindow = new google.maps.InfoWindow({
      content: content,
      maxWidth: 150,
    });
    return function (){
      infowindow.setContent(content);
      infowindow.open(map, this);
    };
  }
  
    function initMap(){
    
      var mapDiv = document.getElementById('map');
      map = new google.maps.Map(mapDiv, {
        zoom: 14,
        center: {lat: 40.7128, lng: -74.0059}
      });

      var geocoder = new google.maps.Geocoder();

      document.getElementById('submit').addEventListener('click', function() {
          geocodeAddress(geocoder, map);
        });

      $.getJSON('pollingdata.json', function(data){
        polldata = data;
        polls();
      });
    }

    var homemarker;

      function geocodeAddress(geocoder, resultsMap) {

        var address = document.getElementById('address').value;
        var image1 = "house.png";
        geocoder.geocode({'address': address}, function(results, status) {

          if(typeof homemarker != 'undefined'){
            homemarker.setMap(null);
          }

          if (status === 'OK') {

            resultsMap.setCenter(results[0].geometry.location);
            homemarker = new google.maps.Marker({
              map: resultsMap,
              icon: image1,
              position: results[0].geometry.location,
            });

            //homemarker.setMap(null);
          } 
          else {
            alert('Geocode was not successful for the following reason: ' + status);
          }
        });
      }

    </script>
  </div>

    <script
    async defer
    src ="https://maps.googleapis.com/maps/api/js?&callback=initMap">
    </script>


  </body>
<html>